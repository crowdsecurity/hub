name: crowdsecurity/vpatch-CVE-2023-1389
description: "TP-Link Archer AX21 - RCE (CVE-2023-1389)"
rules:
  - and:
    - zones:
      - URI
      transform:
      - lowercase
      match:
        type: endsWith
        value: /cgi-bin/luci/;stok=/locale
    - zones:
      - ARGS
      variables:
      - form
      match:
        type: equals
        value: country
    - zones:
      - BODY_ARGS
      - ARGS
      variables:
      - operation
      match:
        type: equals
        value: write
    - zones:
      - BODY_ARGS
      - ARGS
      variables:
      - country
      match:
        type: regex
        value: "[^a-zA-Z0-9_.-]+"

labels:
  type: exploit
  service: http
  confidence: 3
  spoofable: 0
  behavior: "http:exploit"
  label: "TP-Link Archer AX21 - RCE"
  classification:
   - cve.CVE-2023-1389
   - attack.T1595
   - attack.T1190
   - cwe.CWE-77
