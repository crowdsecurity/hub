name: test-configurations
on:
  - push
  - repository_dispatch
  - pull_request_target
jobs:
  build-hub-tests:
    runs-on: ubuntu-latest
    env:
      RESULTS_PATH: .
    steps:
    - name: Set up Go 1.13
      uses: actions/setup-go@v1
      with:
        go-version: 1.13
      id: go
    - name: Check out code into the Go module directory
      uses: actions/checkout@v2
    - name: run tests
      run: |
        ./tests.sh -i
        cd hub-tests
        git stash
        git checkout overhaul
        go build
        cd ..
        ./tests.sh --all
        sudo apt-get update && sudo apt-get install npm
        sudo npm i -g xunit-viewer
        xunit-viewer -r output.xml
        set +x
        mkdir public
        sudo mv index.html public
      id: tests
    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@3.7.1
      with:
        BRANCH: gh-pages
        FOLDER: public
        ACCESS_TOKEN: ${{ secrets.REPO_ACCESS_TOKEN }}
        
