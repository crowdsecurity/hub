onsuccess: next_stage
name: bouddha/wazuh-logs
description: "Parse Wazuh web interface logs for failed login attempts"
filter: "evt.Parsed.program == 'opensearch-dashboards'"
nodes:
  - grok:
      pattern: '{"type":"response","@timestamp":"%{TIMESTAMP_ISO8601:timestamp}","tags":\[],"pid":%{INT:pid},"method":"post","statusCode":401,"req":{"url":"/auth/login","method":"post","headers":{.*},"remoteAddress":"%{IP:source_ip}",.*},"message":"POST /auth/login 401 %{INT:response_time}ms - %{GREEDYDATA}"}'
      apply_on: message
statics:
  - meta: log_type
    value: wazuh_failed_auth
  - meta: source_ip
    expression: "evt.Parsed.source_ip"
  - meta: timestamp
    expression: "evt.Parsed.timestamp"
  - meta: response_time
    expression: "evt.Parsed.response_time"
  - target: evt.StrTime
    value: "${evt.Parsed.timestamp}"
