filter: "evt.Parsed.program startsWith 'zimbra'"
onsuccess: next_stage
#debug: true
name: firewallservices/zimbra-logs
description: "Parse zimbra authentication failures"
nodes:
  - grok:
      pattern: '%{WORD:proto}://%{HOSTNAME:server}:%{INT:port}/service/admin/soap/(AuthRequest)?\] \[.*oip=%{IP:src_ip}.*\] SoapEngine - handler exception: authentication failed for \[%{NGUSER:user}\]'
      apply_on: message
  - grok:
      pattern: '%{WORD:proto}://%{HOSTNAME:server}:%{INT:port}/service/admin/soap/(AuthRequest)?\] \[.*name=%{NGUSER:user}.*oip=%{IP:src_ip}.*\] SoapEngine - handler exception'
      apply_on: message
  - grok:
      pattern: '\[.*oip=%{IP:src_ip}.*\] imap - authentication failed for \[%{NGUSER:user}\]'
      apply_on: message
statics:
  - meta: service
    value: zimbra
  - meta: log_type
    value: zimbra_auth_fail
  - meta: source_ip
    expression: "evt.Parsed.src_ip"
  - meta: user
    expression: "evt.Parsed.user"
