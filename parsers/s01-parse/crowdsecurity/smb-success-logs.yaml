onsuccess: next_stage
name: crowdsecurity/smb-success-logs
filter: evt.Parsed.program == 'smb'
description: "Parse successful SMB authentications"
pattern_syntax:
  SMB_AUTH_SUCCESS: "Auth:%{GREEDYDATA} user \\[%{DATA:smb_domain}\\]\\\\\\[%{DATA:user}\\]%{GREEDYDATA} status \\[NT_STATUS_OK\\]%{GREEDYDATA} remote host \\[ipv4:%{IP:ip_source}"
nodes:
  - grok:
      name: "SMB_AUTH_SUCCESS"
      apply_on: message
statics:
  - meta: log_type
    value: auth_success
  - meta: service
    value: smb
  - meta: source_ip
    expression: "evt.Parsed.ip_source"
  - meta: user
    expression: "evt.Parsed.user"

