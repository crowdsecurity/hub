filter: "evt.Parsed.logsource == 'cri' && evt.Parsed.program == 'envoy'"
onsuccess: next_stage
name: yanis-kouidri/envoy-parser
description: envoy json logs parser
statics:
  - target: evt.StrTime
    expression: JsonExtract(evt.Parsed.message, "start_time")

  - parsed: raw_remote_addr
    expression: JsonExtract(evt.Parsed.message, "downstream_remote_address")
  - parsed: remote_addr
    expression: "Split(evt.Parsed.raw_remote_addr, ':')[0]"
  - parsed: request
    expression: JsonExtract(evt.Parsed.message, "x-envoy-origin-path")
  - parsed: verb
    expression: JsonExtract(evt.Parsed.message, "method")
  - parsed: http_status
    expression: JsonExtract(evt.Parsed.message, "response_code")
  - parsed: user_agent
    expression: JsonExtract(evt.Parsed.message, "user-agent")
  - parsed: target_fqdn
    expression: JsonExtract(evt.Parsed.message, ":authority")
  - parsed: program
    expression: evt.Line.Labels.program

  - meta: service
    value: http
  - meta: log_type
    value: http_access-log
  - meta: source_ip
    expression: "evt.Parsed.remote_addr"
  - meta: http_path
    expression: "evt.Parsed.request"
  - meta: http_verb
    expression: "evt.Parsed.verb"
  - meta: http_status
    expression: "evt.Parsed.http_status"
