onsuccess: next_stage
#debug: false
name: Jgigantino31/calibre-web-logs
description: "Parse calibre-web logs"
filter: "evt.Parsed.program == 'calibre-web'"
pattern_syntax:
  CALIBREWEB_CUSTOMDATE: "%{YEAR}-%{MONTHNUM}-%{MONTHDAY} %{HOUR}:%{MINUTE}:%{SECOND}"
nodes:
  - grok:
      pattern: '(\[%{CALIBREWEB_CUSTOMDATE:timestamp}.*\])?.*Login failed for user "%{HTTPDUSER:username}" IP-address: %{IP:source_ip}'
      apply_on: message
      statics:
        - meta: log_type
          value: calibre-web_failed_auth

statics:
    - meta: service
      value: calibre-web
    - meta: user
      expression: "evt.Parsed.username"
    - meta: source_ip
      expression: "evt.Parsed.source_ip"
    - target: evt.StrTime
      expression: evt.Parsed.timestamp
