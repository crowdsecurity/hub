#filter: '1 == 1'  # For hub tests
filter: evt.Parsed.program == "gotify"  # Production
#debug: true
onsuccess: next_stage
name: baudneo/gotify-logs
description: parser for Gotify server
pattern_syntax:
#  GOTIFY_DATE: %{YEAR}/%{MONTHNUM}/%{NUMBER}\s[\-]\s%{TIME}  ## Grok patterns cause FATAL error for crowdsec
#  GOTIFY_SEPERATOR: %{SPACE}\|%{SPACE}  ## Grok patterns cause FATAL error for crowdsec
  GOTIFY_DATE: \d*/\d*/\d*\s[\-]\s.*
  GOTIFY_SEPERATOR: \s*\|\s*
  GOTIFY_401: ^\[GIN\]\s*%{GOTIFY_DATE}%{GOTIFY_SEPERATOR}401%{GOTIFY_SEPERATOR}%{DATA:request_time_took}%{GOTIFY_SEPERATOR}%{IP:source_ip}%{GOTIFY_SEPERATOR}%{WORD:request_type}\s*\"%{DATA:endpoint}\"
nodes:
  - grok:
      name: "GOTIFY_401"
      apply_on: message
      statics:
        - meta: log_type
          value: gotify_failed_auth


statics:
  - meta: srcIP
    expression: evt.Parsed.srcIP