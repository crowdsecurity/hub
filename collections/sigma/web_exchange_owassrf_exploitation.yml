type: trigger
name: sigma/web_exchange_owassrf_exploitation
description: |
  Detects exploitation attempt of the OWASSRF variant targeting exchange servers It uses the OWA endpoint to access the powershell backend endpoint
filter: |
  evt.Meta.service == 'http' && ((evt.Meta.http_verb == "POST" && int(evt.Meta.http_status) == 200 && (evt.Parsed.http_args contains "/owa/" && evt.Parsed.http_args contains "/powershell") && (evt.Parsed.http_args contains "@" || evt.Parsed.http_args contains "%40")) && (not (evt.Meta.http_user_agent == "ClientInfo" || evt.Meta.http_user_agent == "Microsoft WinRM Client" || evt.Meta.http_user_agent == "Exchange BackEnd Probes")))
blackhole: 2m
labels:
  type: exploit
  remediation: true
