type: trigger
format: 2.0
#debug: true
#  file=http%3A%2F%2F10.0.10.107%2Fzm%2F&lt;/td&gt;&lt;/tr&gt;&lt;script src='/zm/?view=options%26tab=users%26action=delete%26markUids%5B%5D=6%26deleteBtn=Delete'&lt;/script&gt;&line=70
name: baudneo/zoneminder_cve-2022-39285
description: "Detect cve-2022-39285 exploitation attempts"
filter: |
  evt.Meta.log_type in ["http_access-log", "http_error-log"]
  and 
    (
      ( Upper(evt.Meta.http_verb) == "POST" and
          Upper(evt.Meta.http_path) matches Upper('^(?P<path>/.*index.php)?.*(?P<file_query>file=.*&lt;/td&gt;&lt;/tr(?P<payload>.*)&gt;)')
      )
      or 
      Upper(evt.Parsed.rawrequest) matches Upper('^(?P<verb>POST) (?P<path>/.*index.php)?.*(?P<file_query>file=.*&lt;/td&gt;&lt;/tr(?P<payload>.*)&gt;)')
    )
groupby: "evt.Meta.source_ip"
blackhole: 2m
labels:
  remediation: true
  classification:
    - attack.T1595
    - attack.T1190
    - cve.CVE-2022-39285
  spoofable: 0
  confidence: 3
  service: zoneminder
  behavior: "http:exploit"
  label: "Zoneminder CVE-2022-39285"
