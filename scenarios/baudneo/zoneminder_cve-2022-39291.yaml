type: leaky
format: 2.0
#debug: true
#  __csrf_magic=key%3A85866fbcb6a1d7325544a55aa63fb534677f34ca%2C1665102411&request=log&task=create&level=ERR&message=Trenches%20of%20IT%20PoC&browser%5Bname%5D=Chrome&browser%5Bversion%5D=101.0.4951.41&browser%5Bplatform%5D=Windows&file=line=800&view=request HTTP/1.1
name: baudneo/zoneminder_cve-2022-39291
description: "Detect cve-2022-39291 exploitation attempts"
filter: |
  evt.Meta.log_type in ["http_access-log", "http_error-log"]
  and 
  (
  ( Upper(evt.Meta.http_verb) == "POST" and
  Upper(evt.Meta.http_path) matches Upper('^(?P<path>/.*index.php)?.*(?P<view>view=request|request=log|task=create)+.*(?P<request_query>view=request|request=log|task=create)+.*(?P<task_query>view=request|request=log|task=create)+.*')

  )
  or
  Upper(evt.Parsed.rawrequest) matches Upper('^(?P<verb>POST) (?P<path>/.*index.php)?.*(?P<view>view=request|request=log|task=create)+.*(?P<request_query>view=request|request=log|task=create)+.*(?P<task_query>view=request|request=log|task=create)+.*')
  )
groupby: "evt.Meta.source_ip"
capacity: 10
leakspeed: "10s"
blackhole: 2m
labels:
  classification:
    - attack.T1595
    - attack.T1190
    - cve.CVE-2022-39291
  spoofable: 0
  confidence: 3
  service: zoneminder
  behavior: "http:exploit"
  label: "Zoneminder CVE-2022-39291"
  remediation: true
