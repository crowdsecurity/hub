type: trigger
format: 2.0
#debug: true
name: crowdsecurity/apache_log4j2_cve-2021-44228
description: "Detect cve-2021-44228 exploitation attemps"
filter: |
  evt.Meta.log_type in ["http_access-log", "http_error-log"] and 
  (
    any(File("log4j2_cve_2021_44228.txt"), { Upper(evt.Meta.http_path) contains Upper(#)})
  or
    any(File("log4j2_cve_2021_44228.txt"), { Upper(evt.Parsed.http_user_agent) contains Upper(#)})
  or
    any(File("log4j2_cve_2021_44228.txt"), { Upper(evt.Parsed.http_referer) contains Upper(#)})  
  )
data:
  - source_url: https://hub-data.crowdsec.net/web/log4j2_cve_2021_44228.txt
    dest_file: log4j2_cve_2021_44228.txt
    type: string
groupby: "evt.Meta.source_ip"
blackhole: 2m
labels:
  service: apache
  confidence: 3
  spoofable: 0
  classification:
    - attack.T1595
    - attack.T1190
    - cve.CVE-2021-44228
  behavior: "http:exploit"
  label: "Log4j CVE-2021-44228"
  remediation: true
