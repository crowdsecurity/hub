type: trigger
format: 2.0
#debug: true
name: crowdsecurity/apache_log4j2_cve-2021-44228
description: "Detect cve-2021-44228 exploitation attemps"
filter: |
  evt.Meta.log_type in ["http_access-log", "http_error-log"] and 
  (
    any(File("crowdsecurity/log4j2_cve_2021_44228.txt"), { Upper(evt.Meta.http_path) contains Upper(#)})
  or
    any(File("crowdsecurity/log4j2_cve_2021_44228.txt"), { Upper(evt.Parsed.http_user_agent) contains Upper(#)})
  or
    any(File("crowdsecurity/log4j2_cve_2021_44228.txt"), { Upper(evt.Parsed.http_referer) contains Upper(#)})  
  )
data:
  - source_url: https://raw.githubusercontent.com/crowdsecurity/sec-lists/master/web/log4j2_cve_2021_44228.txt
    dest_file: crowdsecurity/log4j2_cve_2021_44228.txt
    type: string
groupby: "evt.Meta.source_ip"
blackhole: 2m
labels:
  type: exploit
  remediation: true
