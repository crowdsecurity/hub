type: trigger
name: crowdsecurity/CVE-2023-23397
description: "Detect CVE-2023-23397 from sysmon events"
filter: |
  evt.Meta.service == 'sysmon' && evt.Parsed.EventID == '1' &&
  evt.Parsed.ParentImage endsWith "\\svchost.exe" &&
  evt.Parsed.Image endsWith "\\rundll32.exe" &&
  evt.Parsed.CommandLine contains "C:\\windows\\system32\\davclnt.dll,DavSetCookie" &&
  evt.Parsed.CommandLine matches '://\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}' &&
  (not (evt.Parsed.CommandLine contains "://10." ||
        evt.Parsed.CommandLine contains "://192.168." ||
        evt.Parsed.CommandLine contains "://172.16." ||
        evt.Parsed.CommandLine contains "://172.17." ||
        evt.Parsed.CommandLine contains "://172.18." ||
        evt.Parsed.CommandLine contains "://172.19." ||
        evt.Parsed.CommandLine contains "://172.20." ||
        evt.Parsed.CommandLine contains "://172.21." ||
        evt.Parsed.CommandLine contains "://172.22." ||
        evt.Parsed.CommandLine contains "://172.23." ||
        evt.Parsed.CommandLine contains "://172.24." ||
        evt.Parsed.CommandLine contains "://172.25." ||
        evt.Parsed.CommandLine contains "://172.26." ||
        evt.Parsed.CommandLine contains "://172.27." ||
        evt.Parsed.CommandLine contains "://172.28." ||
        evt.Parsed.CommandLine contains "://172.29." ||
        evt.Parsed.CommandLine contains "://172.30." ||
        evt.Parsed.CommandLine contains "://172.31." ||
        evt.Parsed.CommandLine contains "://127." ||
        evt.Parsed.CommandLine contains "://169.254."))
labels:
  notification: true
  os: windows
  classification:
    - attack.T1068
    - cve.CVE-2023-23397
  spoofable: 0
  confidence: 3
  behavior: "http:exploit"
  label: "Microsoft Outlook CVE-2023-23397"
  service: windows
scope:
  type: user_account
  expression: evt.Parsed.User
