type: trigger
name: crowdsecurity/k8s-audit-anonymous-access
description: "Detect allowed anonymous access to the K8S API"
filter: |
   evt.Meta.log_type == 'k8s-audit' &&
   evt.Unmarshaled.ObjectRef?.Resource not in ["healthz", "livez", "readyz"] &&
   (evt.Meta.user in ["system:anonymous", "system:unauthenticated"])
labels:
 service: k8s
 type: apiserver-anonymous-access
 notification: true