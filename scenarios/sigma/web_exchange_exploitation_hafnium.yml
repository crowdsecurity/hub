type: trigger
name: sigma/web_exchange_exploitation_hafnium
description: |
  Detects exploitation attempts in Exchange server logs as described in blog posts reporting on HAFNIUM group activity
filter: |
  evt.Meta.service == 'http' && ((evt.Meta.http_verb == "POST" && evt.Parsed.http_args contains "/owa/auth/Current/themes/resources/") || (evt.Meta.http_verb == "POST" && evt.Parsed.http_args contains "/owa/auth/Current/" && (evt.Meta.http_user_agent == "DuckDuckBot/1.0;+(+http://duckduckgo.com/duckduckbot.html)" || evt.Meta.http_user_agent == "facebookexternalhit/1.1+(+http://www.facebook.com/externalhit_uatext.php)" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+Bingbot/2.0;++http://www.bing.com/bingbot.htm)" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+Googlebot/2.1;++http://www.google.com/bot.html" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+Konqueror/3.5;+Linux)+KHTML/3.5.5+(like+Gecko)+(Exabot-Thumbnails)" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+Yahoo!+Slurp;+http://help.yahoo.com/help/us/ysearch/slurp)" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+YandexBot/3.0;++http://yandex.com/bots)" || evt.Meta.http_user_agent == "Mozilla/5.0+(X11;+Linux+x86_64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/51.0.2704.103+Safari/537.36")) || (evt.Parsed.http_args contains "/ecp/" && evt.Meta.http_verb == "POST" && (evt.Meta.http_user_agent == "ExchangeServicesClient/0.0.0.0" || evt.Meta.http_user_agent == "python-requests/2.19.1" || evt.Meta.http_user_agent == "python-requests/2.25.1")) || ((evt.Parsed.http_args contains "/aspnet_client/" || evt.Parsed.http_args contains "/owa/") && evt.Meta.http_verb == "POST" && (evt.Meta.http_user_agent == "antSword/v2.1" || evt.Meta.http_user_agent == "Googlebot/2.1+(+http://www.googlebot.com/bot.html)" || evt.Meta.http_user_agent == "Mozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)")) || ((evt.Parsed.http_args contains "/owa/auth/Current/" || evt.Parsed.http_args contains "/ecp/default.flt" || evt.Parsed.http_args contains "/ecp/main.css") && evt.Meta.http_verb == "POST") || (evt.Meta.http_verb == "POST" && (evt.Parsed.http_args contains "/ecp/" && evt.Parsed.http_args contains ".js")))
blackhole: 2m
labels:
  type: exploit
  remediation: true
