type: trigger
name: sigma/proc_creation_win_sysinternals_tools_masquerading
description: |
  Detects binaries that use the same name as legitimate sysinternals tools to evade detection
filter: |
  (evt.Meta.service == 'sysmon' && evt.Parsed.EventID == '1') && ((evt.Parsed.Image endsWith '\\accesschk.exe' || evt.Parsed.Image endsWith '\\accesschk64.exe' || evt.Parsed.Image endsWith '\\AccessEnum.exe' || evt.Parsed.Image endsWith '\\ADExplorer.exe' || evt.Parsed.Image endsWith '\\ADExplorer64.exe' || evt.Parsed.Image endsWith '\\ADInsight.exe' || evt.Parsed.Image endsWith '\\ADInsight64.exe' || evt.Parsed.Image endsWith '\\adrestore.exe' || evt.Parsed.Image endsWith '\\adrestore64.exe' || evt.Parsed.Image endsWith '\\Autologon.exe' || evt.Parsed.Image endsWith '\\Autologon64.exe' || evt.Parsed.Image endsWith '\\Autoruns.exe' || evt.Parsed.Image endsWith '\\Autoruns64.exe' || evt.Parsed.Image endsWith '\\autorunsc.exe' || evt.Parsed.Image endsWith '\\autorunsc64.exe' || evt.Parsed.Image endsWith '\\Bginfo.exe' || evt.Parsed.Image endsWith '\\Bginfo64.exe' || evt.Parsed.Image endsWith '\\Cacheset.exe' || evt.Parsed.Image endsWith '\\Cacheset64.exe' || evt.Parsed.Image endsWith '\\Clockres.exe' || evt.Parsed.Image endsWith '\\Clockres64.exe' || evt.Parsed.Image endsWith '\\Contig.exe' || evt.Parsed.Image endsWith '\\Contig64.exe' || evt.Parsed.Image endsWith '\\Coreinfo.exe' || evt.Parsed.Image endsWith '\\Coreinfo64.exe' || evt.Parsed.Image endsWith '\\CPUSTRES.EXE' || evt.Parsed.Image endsWith '\\CPUSTRES64.EXE' || evt.Parsed.Image endsWith '\\ctrl2cap.exe' || evt.Parsed.Image endsWith '\\Dbgview.exe' || evt.Parsed.Image endsWith '\\dbgview64.exe' || evt.Parsed.Image endsWith '\\Desktops.exe' || evt.Parsed.Image endsWith '\\Desktops64.exe' || evt.Parsed.Image endsWith '\\disk2vhd.exe' || evt.Parsed.Image endsWith '\\disk2vhd64.exe' || evt.Parsed.Image endsWith '\\diskext.exe' || evt.Parsed.Image endsWith '\\diskext64.exe' || evt.Parsed.Image endsWith '\\Diskmon.exe' || evt.Parsed.Image endsWith '\\Diskmon64.exe' || evt.Parsed.Image endsWith '\\DiskView.exe' || evt.Parsed.Image endsWith '\\DiskView64.exe' || evt.Parsed.Image endsWith '\\du.exe' || evt.Parsed.Image endsWith '\\du64.exe' || evt.Parsed.Image endsWith '\\efsdump.exe' || evt.Parsed.Image endsWith '\\FindLinks.exe' || evt.Parsed.Image endsWith '\\FindLinks64.exe' || evt.Parsed.Image endsWith '\\handle.exe' || evt.Parsed.Image endsWith '\\handle64.exe' || evt.Parsed.Image endsWith '\\hex2dec.exe' || evt.Parsed.Image endsWith '\\hex2dec64.exe' || evt.Parsed.Image endsWith '\\junction.exe' || evt.Parsed.Image endsWith '\\junction64.exe' || evt.Parsed.Image endsWith '\\ldmdump.exe' || evt.Parsed.Image endsWith '\\listdlls.exe' || evt.Parsed.Image endsWith '\\listdlls64.exe' || evt.Parsed.Image endsWith '\\livekd.exe' || evt.Parsed.Image endsWith '\\livekd64.exe' || evt.Parsed.Image endsWith '\\loadOrd.exe' || evt.Parsed.Image endsWith '\\loadOrd64.exe' || evt.Parsed.Image endsWith '\\loadOrdC.exe' || evt.Parsed.Image endsWith '\\loadOrdC64.exe' || evt.Parsed.Image endsWith '\\logonsessions.exe' || evt.Parsed.Image endsWith '\\logonsessions64.exe' || evt.Parsed.Image endsWith '\\movefile.exe' || evt.Parsed.Image endsWith '\\movefile64.exe' || evt.Parsed.Image endsWith '\\notmyfault.exe' || evt.Parsed.Image endsWith '\\notmyfault64.exe' || evt.Parsed.Image endsWith '\\notmyfaultc.exe' || evt.Parsed.Image endsWith '\\notmyfaultc64.exe' || evt.Parsed.Image endsWith '\\ntfsinfo.exe' || evt.Parsed.Image endsWith '\\ntfsinfo64.exe' || evt.Parsed.Image endsWith '\\pendmoves.exe' || evt.Parsed.Image endsWith '\\pendmoves64.exe' || evt.Parsed.Image endsWith '\\pipelist.exe' || evt.Parsed.Image endsWith '\\pipelist64.exe' || evt.Parsed.Image endsWith '\\portmon.exe' || evt.Parsed.Image endsWith '\\procdump.exe' || evt.Parsed.Image endsWith '\\procdump64.exe' || evt.Parsed.Image endsWith '\\procexp.exe' || evt.Parsed.Image endsWith '\\procexp64.exe' || evt.Parsed.Image endsWith '\\Procmon.exe' || evt.Parsed.Image endsWith '\\Procmon64.exe' || evt.Parsed.Image endsWith '\\psExec.exe' || evt.Parsed.Image endsWith '\\psExec64.exe' || evt.Parsed.Image endsWith '\\psfile.exe' || evt.Parsed.Image endsWith '\\psfile64.exe' || evt.Parsed.Image endsWith '\\psGetsid.exe' || evt.Parsed.Image endsWith '\\psGetsid64.exe' || evt.Parsed.Image endsWith '\\psInfo.exe' || evt.Parsed.Image endsWith '\\psInfo64.exe' || evt.Parsed.Image endsWith '\\pskill.exe' || evt.Parsed.Image endsWith '\\pskill64.exe' || evt.Parsed.Image endsWith '\\pslist.exe' || evt.Parsed.Image endsWith '\\pslist64.exe' || evt.Parsed.Image endsWith '\\psLoggedon.exe' || evt.Parsed.Image endsWith '\\psLoggedon64.exe' || evt.Parsed.Image endsWith '\\psloglist.exe' || evt.Parsed.Image endsWith '\\psloglist64.exe' || evt.Parsed.Image endsWith '\\pspasswd.exe' || evt.Parsed.Image endsWith '\\pspasswd64.exe' || evt.Parsed.Image endsWith '\\psping.exe' || evt.Parsed.Image endsWith '\\psping64.exe' || evt.Parsed.Image endsWith '\\psService.exe' || evt.Parsed.Image endsWith '\\psService64.exe' || evt.Parsed.Image endsWith '\\psshutdown.exe' || evt.Parsed.Image endsWith '\\psshutdown64.exe' || evt.Parsed.Image endsWith '\\pssuspend.exe' || evt.Parsed.Image endsWith '\\pssuspend64.exe' || evt.Parsed.Image endsWith '\\RAMMap.exe' || evt.Parsed.Image endsWith '\\RDCMan.exe' || evt.Parsed.Image endsWith '\\RegDelNull.exe' || evt.Parsed.Image endsWith '\\RegDelNull64.exe' || evt.Parsed.Image endsWith '\\regjump.exe' || evt.Parsed.Image endsWith '\\ru.exe' || evt.Parsed.Image endsWith '\\ru64.exe' || evt.Parsed.Image endsWith '\\sdelete.exe' || evt.Parsed.Image endsWith '\\sdelete64.exe' || evt.Parsed.Image endsWith '\\ShareEnum.exe' || evt.Parsed.Image endsWith '\\ShareEnum64.exe' || evt.Parsed.Image endsWith '\\shellRunas.exe' || evt.Parsed.Image endsWith '\\sigcheck.exe' || evt.Parsed.Image endsWith '\\sigcheck64.exe' || evt.Parsed.Image endsWith '\\streams.exe' || evt.Parsed.Image endsWith '\\streams64.exe' || evt.Parsed.Image endsWith '\\strings.exe' || evt.Parsed.Image endsWith '\\strings64.exe' || evt.Parsed.Image endsWith '\\sync.exe' || evt.Parsed.Image endsWith '\\sync64.exe' || evt.Parsed.Image endsWith '\\Sysmon.exe' || evt.Parsed.Image endsWith '\\Sysmon64.exe' || evt.Parsed.Image endsWith '\\tcpvcon.exe' || evt.Parsed.Image endsWith '\\tcpvcon64.exe' || evt.Parsed.Image endsWith '\\tcpview.exe' || evt.Parsed.Image endsWith '\\tcpview64.exe' || evt.Parsed.Image endsWith '\\Testlimit.exe' || evt.Parsed.Image endsWith '\\Testlimit64.exe' || evt.Parsed.Image endsWith '\\vmmap.exe' || evt.Parsed.Image endsWith '\\vmmap64.exe' || evt.Parsed.Image endsWith '\\Volumeid.exe' || evt.Parsed.Image endsWith '\\Volumeid64.exe' || evt.Parsed.Image endsWith '\\whois.exe' || evt.Parsed.Image endsWith '\\whois64.exe' || evt.Parsed.Image endsWith '\\Winobj.exe' || evt.Parsed.Image endsWith '\\Winobj64.exe' || evt.Parsed.Image endsWith '\\ZoomIt.exe' || evt.Parsed.Image endsWith '\\ZoomIt64.exe') && not (evt.Parsed.Company == 'Sysinternals - www.sysinternals.com' || evt.Parsed.Company == 'Sysinternals' || evt.Parsed.Company == ''))
blackhole: 2m
#status: experimental
labels:
  service: windows
  confidence: 0
  spoofable: 0
#  classification:
#  - attack.t1218
#  - attack.t1202

  label: "Potential Binary Impersonating Sysinternals Tools"
  behavior : "windows:audit"
  remediation: false

scope:
  type: ParentProcessId
  expression: evt.Parsed.ParentProcessId

