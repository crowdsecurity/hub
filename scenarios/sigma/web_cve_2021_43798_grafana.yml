type: trigger
name: sigma/web_cve_2021_43798_grafana
description: |
  Detects a successful Grafana path traversal exploitation
filter: |
  evt.Meta.service == 'http' && ((evt.Parsed.http_args contains "/../../../../../../../" && int(evt.Meta.http_status) == 200) && (evt.Parsed.http_args contains "/public/plugins/live" || evt.Parsed.http_args contains "/public/plugins/icon" || evt.Parsed.http_args contains "/public/plugins/loki" || evt.Parsed.http_args contains "/public/plugins/text" || evt.Parsed.http_args contains "/public/plugins/logs" || evt.Parsed.http_args contains "/public/plugins/news" || evt.Parsed.http_args contains "/public/plugins/stat" || evt.Parsed.http_args contains "/public/plugins/mssql" || evt.Parsed.http_args contains "/public/plugins/mixed" || evt.Parsed.http_args contains "/public/plugins/mysql" || evt.Parsed.http_args contains "/public/plugins/tempo" || evt.Parsed.http_args contains "/public/plugins/graph" || evt.Parsed.http_args contains "/public/plugins/gauge" || evt.Parsed.http_args contains "/public/plugins/table" || evt.Parsed.http_args contains "/public/plugins/debug" || evt.Parsed.http_args contains "/public/plugins/zipkin" || evt.Parsed.http_args contains "/public/plugins/jaeger" || evt.Parsed.http_args contains "/public/plugins/geomap" || evt.Parsed.http_args contains "/public/plugins/canvas" || evt.Parsed.http_args contains "/public/plugins/grafana" || evt.Parsed.http_args contains "/public/plugins/welcome" || evt.Parsed.http_args contains "/public/plugins/xychart" || evt.Parsed.http_args contains "/public/plugins/heatmap" || evt.Parsed.http_args contains "/public/plugins/postgres" || evt.Parsed.http_args contains "/public/plugins/testdata" || evt.Parsed.http_args contains "/public/plugins/opentsdb" || evt.Parsed.http_args contains "/public/plugins/influxdb" || evt.Parsed.http_args contains "/public/plugins/barchart" || evt.Parsed.http_args contains "/public/plugins/annolist" || evt.Parsed.http_args contains "/public/plugins/bargauge" || evt.Parsed.http_args contains "/public/plugins/graphite" || evt.Parsed.http_args contains "/public/plugins/dashlist" || evt.Parsed.http_args contains "/public/plugins/piechart" || evt.Parsed.http_args contains "/public/plugins/dashboard" || evt.Parsed.http_args contains "/public/plugins/nodeGraph" || evt.Parsed.http_args contains "/public/plugins/alertlist" || evt.Parsed.http_args contains "/public/plugins/histogram" || evt.Parsed.http_args contains "/public/plugins/table-old" || evt.Parsed.http_args contains "/public/plugins/pluginlist" || evt.Parsed.http_args contains "/public/plugins/timeseries" || evt.Parsed.http_args contains "/public/plugins/cloudwatch" || evt.Parsed.http_args contains "/public/plugins/prometheus" || evt.Parsed.http_args contains "/public/plugins/stackdriver" || evt.Parsed.http_args contains "/public/plugins/alertGroups" || evt.Parsed.http_args contains "/public/plugins/alertmanager" || evt.Parsed.http_args contains "/public/plugins/elasticsearch" || evt.Parsed.http_args contains "/public/plugins/gettingstarted" || evt.Parsed.http_args contains "/public/plugins/state-timeline" || evt.Parsed.http_args contains "/public/plugins/status-history" || evt.Parsed.http_args contains "/public/plugins/grafana-clock-panel" || evt.Parsed.http_args contains "/public/plugins/grafana-simple-json-datasource" || evt.Parsed.http_args contains "/public/plugins/grafana-azure-monitor-datasource"))
blackhole: 2m
labels:
  type: exploit
  remediation: true
