type: trigger
name: sigma/proc_creation_win_certutil_decode
description: |
  Detects the execution of certutil with either the "decode" or "decodehex" flags to decode base64 or hex encoded files. This can be abused by attackers to decode an encoded payload before execution
filter: |
  (evt.Meta.service == 'sysmon' && evt.Parsed.EventID == '1') && ((evt.Parsed.Image endsWith '\\certutil.exe' || evt.Parsed.OriginalFileName == 'CertUtil.exe') && (evt.Parsed.CommandLine contains '-decode ' || evt.Parsed.CommandLine contains '/decode ' || evt.Parsed.CommandLine contains '-decodehex ' || evt.Parsed.CommandLine contains '/decodehex '))
blackhole: 2m
#status: test
labels:
  service: windows
  confidence: 1
  spoofable: 0
#  classification:
#  - attack.t1027

  label: "File Decoded From Base64/Hex Via Certutil.EXE"
  behavior : "windows:audit"
  remediation: false

scope:
  type: ParentProcessId
  expression: evt.Parsed.ParentProcessId

