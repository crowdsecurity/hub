type: trigger
name: sigma/web_exchange_proxyshell_successful
description: |
  Detects URP patterns and status codes that indicate a successful ProxyShell exploitation attack against Exchange servers
filter: |
  evt.Meta.service == 'http' && (evt.Parsed.http_args contains "/autodiscover.json" && (evt.Parsed.http_args contains "/powershell" || evt.Parsed.http_args contains "/mapi/nspi" || evt.Parsed.http_args contains "/EWS" || evt.Parsed.http_args contains "X-Rps-CAT") && (int(evt.Meta.http_status) == 200 || int(evt.Meta.http_status) == 301))
blackhole: 2m
labels:
  type: exploit
  remediation: true
